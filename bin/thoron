#!/bin/bash

printf '\033]2;Thoron Framework\a'

G="\033[1;34m[*] \033[0m"
S="\033[1;32m[+] \033[0m"
E="\033[1;31m[-] \033[0m"

if [[ -d ~/thoron ]]; then
    {
        cd ~/thoron
        mkdir etc/.disabled
        mv core/payloads.rb etc/.disabled
        mv etc/core/payloads.rb ~/thoron/core
        cp etc/.disabled/payloads.rb etc
        rm -rf etc/.disabled
    } &> /dev/null
    chmod +x thoron
    ./thoron
    {
        cd ~/thoron
        mkdir etc/.disabled
        mv core/payloads.rb etc/.disabled
        mv etc/core/payloads.rb ~/thoron/core
        cp etc/.disabled/payloads.rb etc
        rm -rf etc/.disabled
    } &> /dev/null
else
    {
        CHECK="$(ping -c 1 -q www.google.com >&/dev/null; echo $?)"
    } &> /dev/null
    if [[ "$CHECK" = 0 ]]; then 
        cd ~
        {
            git clone https://github.com/EntySec/thoron.git
            cd $OLDPWD
            cd ~/thoron
            mkdir etc/.disabled
            mv core/payloads.rb etc/.disabled
            mv etc/core/payloads.rb ~/thoron/core
            cp etc/.disabled/payloads.rb etc
            rm -rf etc/.disabled
        } &> /dev/null
        if [[ ! -d ~/thoron ]]; then
            echo -e ""$E"Execution failed!"
            exit
        fi
        chmod +x thoron
        ./thoron
        {
            if [[ -f ~/thoron/.updated ]]; then
                rm ~/thoron/.updated
            else
                cd ~/thoron
                mkdir etc/.disabled
                mv core/payloads.rb etc/.disabled
                mv etc/core/payloads.rb ~/thoron/core
                cp etc/.disabled/payloads.rb etc
                rm -rf etc/.disabled
            fi
        } &> /dev/null
    else
        echo -e ""$E"Execution failed!"
        exit
    fi
fi
